<!DOCTYPE html>
<html>
<head>
<style>body{padding:1.875rem;}</style><meta charset='UTF-8'>
</head>
<body><p>首先导入依赖</p><pre><code class="language-shell">&lt;dependency&gt;
    &lt;groupId&gt;com.qcloud&lt;/groupId&gt;
    &lt;artifactId&gt;cos_api&lt;/artifactId&gt;
    &lt;version&gt;5.6.8&lt;/version&gt;
&lt;/dependency&gt;</code></pre><p>cos客户端工具类</p><pre><span>package </span>com.wdz.tenxunyuncos;<br><br><span>import </span>com.qcloud.cos.COSClient;<br><span>import </span>com.qcloud.cos.ClientConfig;<br><span>import </span>com.qcloud.cos.auth.BasicCOSCredentials;<br><span>import </span>com.qcloud.cos.auth.COSCredentials;<br><span>import </span>com.qcloud.cos.model.Bucket;<br><span>import </span>com.qcloud.cos.region.Region;<br><br><span>import </span>java.util.List;<br><br><span>/**<br></span><span> * 腾讯云对象存储客户端操作工具类<br></span><span> */<br></span><span>public class </span>COSClientUtil {<br><br>    <span>/**<br></span><span>     * 获取腾讯云cos客户端对象<br></span><span>     * </span><span>@return<br></span><span>     </span><span>*/<br></span><span>    </span><span>public static </span>COSClient getCOSClient(){<br><p>        <span>// 1 初始化用户身份信息（secretId, secretKey</span>在腾讯下控制台的密钥管理上获取）。</p><span>        </span>String secretId = <span>"******"</span>;//<br>        String secretKey = <span>"*******"</span>;<br>        COSCredentials cred = <span>new </span>BasicCOSCredentials(secretId, secretKey);<br>        <span>// 2 设置 bucket 的区域, COS 地域的简称请参照 https://cloud.tencent.com/document/product/436/6224<br></span><span>        // clientConfig 中包含了设置 region, https(默认 http), 超时, 代理等 set 方法, 使用可参见源码或者常见问题 Java SDK 部分。<br></span><span>        </span>Region region = <span>new </span>Region(<span>"**********"</span>);<br>        ClientConfig clientConfig = <span>new </span>ClientConfig(region);<br>        <span>// 3 生成 cos 客户端。<br></span><span>        </span><span>return new </span>COSClient(cred, clientConfig);<br>    }<br><br>    <span>public static void </span>main(String[] args) {<br>        //测试，查询存储桶列表<br>        COSClient cosClient = <span>getCOSClient</span>();//获取cos客户端对象<br>        List&lt;Bucket&gt; buckets = cosClient.listBuckets();<br>        <span>for </span>(Bucket bucketElement : buckets) {<br>            String bucketName = bucketElement.getName();//获取存储桶名<br>            String bucketLocation = bucketElement.getLocation();//获取存储桶路径<br>            System.<span>out</span>.println(bucketName+<span>":"</span>+bucketLocation);<br>        }<br>    }<br><br>}</pre><p>cos业务类</p><pre><span>package </span>com.wdz.tenxunyuncos;<br><br><span>import </span>com.qcloud.cos.COSClient;<br><span>import </span>com.qcloud.cos.exception.CosClientException;<br><span>import </span>com.qcloud.cos.exception.CosServiceException;<br><span>import </span>com.qcloud.cos.model.*;<br><br><span>import </span>java.io.File;<br><span>import </span>java.util.ArrayList;<br><span>import </span>java.util.HashMap;<br><span>import </span>java.util.List;<br><span>import </span>java.util.Map;<br><br><span>/**<br></span><span> * cos业务类<br></span><span> */<br></span><span>public class </span>COSService {<br><br>    <span>/**<br></span><span>     *<br></span><span>     * </span><span>@param </span><span>bucketName </span><span>存储桶名<br></span><span>     * </span><span>@param </span><span>prefix </span><span>查询的文件夹的名字<br></span><span>     */<br></span><span>    </span><span>public static </span>List&lt;Map&lt;String, Object&gt;&gt; getFiels(String bucketName, String prefix){<br>        COSClient cosClient = COSClientUtil.<span>getCOSClient</span>();<br>        <span>// Bucket的命名格式为 BucketName-APPID ，此处填写的存储桶名称必须为此格式<br></span><span>        //bucketName = "wdz-1258450135";<br></span><span>        </span>ListObjectsRequest listObjectsRequest = <span>new </span>ListObjectsRequest();<br>        <span>// 设置bucket名称<br></span><span>        </span>listObjectsRequest.setBucketName(bucketName);<br>        <span>// prefix表示列出的object的key以prefix开始<br></span><span>        //prefix = "";<br></span><span>        </span>listObjectsRequest.setPrefix(prefix);<br>        <span>// deliter表示分隔符, 设置为/表示列出当前目录下的object, 设置为空表示列出所有的object<br></span><span>        </span>listObjectsRequest.setDelimiter(<span>"/"</span>);<br>        <span>// 设置最大遍历出多少个对象, 一次listobject最大支持1000<br></span><span>        </span>listObjectsRequest.setMaxKeys(<span>1000</span>);<br>        ObjectListing objectListing = <span>null</span>;<br>        <span>//创建接受文件对象的容器<br></span><span>        </span>List&lt;Map&lt;String,Object&gt;&gt; list = <span>new </span>ArrayList&lt;&gt;();<br>        <span>try </span>{<br>            <span>do </span>{<br>                objectListing = cosClient.listObjects(listObjectsRequest);<br>                <span>// common prefix表示表示被delimiter截断的路径, 如delimter设置为/, common prefix则表示所有子目录的路径<br></span><span>                </span>List&lt;String&gt; commonPrefixs = objectListing.getCommonPrefixes();<br>                <span>// object summary表示所有列出的object列表<br></span><span>                </span>List&lt;COSObjectSummary&gt; cosObjectSummaries = objectListing.getObjectSummaries();<br>                <span>//创建接受文件的子容器<br></span><span>                </span>Map&lt;String,Object&gt; map = <span>null</span>;<br>                <span>for </span>(COSObjectSummary cosObjectSummary : cosObjectSummaries) {<br>                    map = <span>new </span>HashMap&lt;&gt;();<br>                    <span>//存储整个对象<br></span><span>                    </span>map.put(<span>"cosObjectSummary"</span>,cosObjectSummary);<br>                    <span>// 文件的路径key<br></span><span>                    </span>map.put(<span>"key"</span>,cosObjectSummary.getKey());<br>                    <span>// 文件的etag<br></span><span>                    </span>map.put(<span>"etag"</span>,cosObjectSummary.getETag());<br>                    <span>// 文件的长度<br></span><span>                    </span>map.put(<span>"fileSize"</span>,cosObjectSummary.getSize());<br>                    <span>// 文件的存储类型<br></span><span>                    </span>map.put(<span>"storageClasses"</span>,cosObjectSummary.getStorageClass());<br>                    list.add(map);<br>                }<br>                String nextMarker = objectListing.getNextMarker();<br>                listObjectsRequest.setMarker(nextMarker);<br>            } <span>while </span>(objectListing.isTruncated());<br>         } <span>catch </span>(CosServiceException e) {<br>        e.printStackTrace();<br>    } <span>catch </span>(CosClientException e) {<br>        e.printStackTrace();<br>    } <span>finally </span>{<br>            cosClient.shutdown();<br>        }<br>        <span>return </span>list;<br>    }<br><br>    <span>/**<br></span><span>     *<br></span><span>     * </span><span>@param </span><span>localFile </span><span>文件<br></span><span>     * </span><span>@param </span><span>bucketName </span><span>存储桶<br></span><span>     * </span><span>@param </span><span>key </span><span>文件名（存储桶上的对象键)<br></span><span>     */<br></span><span>    </span><span>public static void </span>upload(File localFile,String bucketName,String key){<br>        COSClient cosClient = COSClientUtil.<span>getCOSClient</span>();<br>        <span>// 指定要上传的文件<br></span><span>        /*File localFile = new File(localFilePath);*/<br></span><span>        // 指定要上传到的存储桶<br></span><span>        // 指定要上传到 COS 上对象键<br></span><span>        //String key = "exampleobject";<br></span><span>        </span>PutObjectRequest putObjectRequest = <span>new </span>PutObjectRequest(bucketName, key, localFile);<br>        PutObjectResult putObjectResult = cosClient.putObject(putObjectRequest);<br>        cosClient.shutdown();<br>    }<br><br>    <span>public static void </span>main(String[] args) {<br>        <span>//System.out.println(getFiels("*****",""));<br></span><span>        </span>File file = <span>new </span>File(<span>"C:/Users/Administrator/Pictures/gsl.jpg"</span>);<br>        <span>upload</span>(file,<span>"********"</span>,<span>"/test/test.jpg"</span>);<br>    }<br>}</pre><p><br></p></body>
</html>
