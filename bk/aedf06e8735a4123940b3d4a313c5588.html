<!DOCTYPE html>
<html>
<head>
<style>body{padding:1.875rem;}</style><meta charset='UTF-8'>
</head>
<body><p>注意：启动zookeeper的命令窗口别关闭</p><p>maven导入：</p><pre><span>&lt;</span><span>dependency</span><span>&gt;</span><br>    <span>&lt;</span><span>groupId</span><span>&gt;</span>org.springframework.kafka<span>&lt;/</span><span>groupId</span><span>&gt;</span><br>    <span>&lt;</span><span>artifactId</span><span>&gt;</span>spring-kafka<span>&lt;/</span><span>artifactId</span><span>&gt;</span><br><p><span>&lt;/</span><span>dependency</span><span>&gt;
</span><p><span>可能还需要导入其他的包</span></p><p>&lt;dependency&gt;<span>
</span></p>    &lt;groupId&gt;com.alibaba&lt;/groupId&gt;
     &lt;artifactId&gt;fastjson&lt;/artifactId&gt;
<p>     &lt;version&gt;1.2.56&lt;/version&gt;</p><p>&lt;/dependency&gt;</p><p><span><br></span></p></p></pre><p>yml配置文件：</p><pre><span>kafka</span>:<br>  <span>#制定Kafka代理地址<br></span><span>  </span><span>bootstrap-servers</span>: localhost:9092<br>  <span>producer</span>:<br>    <span>#消息发送失败重试次数<br></span><span>    </span><span>retries</span>: <span>0<br></span><span>    </span><span>#每次批量发送消息的数量<br></span><span>    </span><span>batch-size</span>: 16384<br>    <span>#每次批量发送消息的缓冲区大小<br></span><span>    </span><span>buffer-memory</span>: 335554432<br>    <span>#指定消息key和消息体的编解码方式<br></span><span>    </span><span>key-serializer</span>: org.apache.kafka.common.serialization.StringSerializer<br>    <span>value-serializer</span>: org.apache.kafka.common.serialization.StringSerializer<br><br>  <span>#=============== 消费者  =======================<br></span><span>  #指定默认消费者group id<br></span><span>  </span><span>consumer</span>:<br>    <span>group-id</span>: test-consumer-group<br>    <span>auto-offset-reset</span>: earliest<br>    <span>enable-auto-commit</span>: <span>true<br></span><span>    auto-commit-interval</span>: 100<br>    <span>#指定消息key和消息体的编解码方式<br></span><span>    </span><span>key-deserializer</span>: org.apache.kafka.common.serialization.StringDeserializer<br>    <span>value-deserializer</span>: org.apache.kafka.common.serialization.StringDeserializer</pre><p>也可以使用.properties(与yml两者选其中一个)</p><p>server.port=8080</p><p>#制定kafka代理地址</p><p>spring.kafka.bootstrap-servers=localhost:9092</p><p>#消息发送失败重试次数</p><p>spring.kafka.producer.retries=0</p><p>#每次批量发送消息的数量</p><p>spring.kafka.producer.batch-size=16384</p><p>#每次批量发送消息的缓冲区大小</p><p>spring.kafka.producer.buffer-memory=335554432</p><p># 指定消息key和消息体的编解码方式</p><p>spring.kafka.producer.key-serializer=org.apache.kafka.common.serialization.StringSerializer</p><p>spring.kafka.producer.value-serializer=org.apache.kafka.common.serialization.StringSerializer</p><p><br></p><p>#=============== consumer&nbsp; =======================</p><p># 指定默认消费者group id</p><p>spring.kafka.consumer.group-id=user-log-group</p><p><br></p><p>spring.kafka.consumer.auto-offset-reset=earliest</p><p>spring.kafka.consumer.enable-auto-commit=true</p><p>spring.kafka.consumer.auto-commit-interval=100</p><p><br></p><p># 指定消息key和消息体的编解码方式</p><p>spring.kafka.consumer.key-deserializer=org.apache.kafka.common.serialization.StringDeserializer</p><p>spring.kafka.consumer.value-deserializer=org.apache.kafka.common.serialization.StringDeserializer</p><p>启动类</p><pre><span>package </span>com.wdz;<br><br><span>import </span>com.wdz.fifter.WebAppConfig;<br><span>import </span>com.wdz.kafka.UserLogProducer;<br><span>import </span>org.springframework.beans.factory.annotation.<span>Autowired</span>;<br><span>import </span>org.springframework.boot.SpringApplication;<br><span>import </span>org.springframework.boot.autoconfigure.<span>SpringBootApplication</span>;<br><br><span>import </span>javax.annotation.<span>PostConstruct</span>;<br><span>import </span>java.util.ArrayList;<br><span>import </span>java.util.List;<br><br><span>@SpringBootApplication<br></span><span>public class </span>QianduanApplication {<br><br>    <span>public static void </span>main(String[] args) {<br>        <span>//配置不拦截请求<br></span><span>        </span>List&lt;String&gt; list = <span>new </span>ArrayList&lt;&gt;();<br>        list.add(<span>"/BKshouye/**"</span>);<br>        WebAppConfig.<span>pathPatterns </span>= list;<br>        SpringApplication.<span>run</span>(QianduanApplication.<span>class</span>, args);<br>    }<br><br>    <span>@Autowired<br></span><span>    </span><span>private </span>UserLogProducer <span>userLogProducer</span>;<br><br>    <span>@PostConstruct<br></span><span>    </span><span>public  void </span>init() {<br>        <span>for </span>(<span>int </span>i = <span>0</span>; i &lt; <span>10</span>; i++) {<br>            <span>userLogProducer</span>.sendlog(String.<span>valueOf</span>(i));<br>        }<br>    }<br><br>}<br></pre><p>实体类</p><pre><span>package </span>com.wdz.kafka;<br><br><span>public class </span>UserLog {<br>    <span>private  </span>String <span>username</span>;<br>    <span>private </span>String <span>userid</span>;<br>    <span>private </span>String <span>state</span>;<br><br>    <span>public </span>String getUsername() {<br>        <span>return </span><span>username</span>;<br>    }<br><br>    <span>public void </span>setUsername(String username) {<br>        <span>this</span>.<span>username </span>= username;<br>    }<br><br>    <span>public </span>String getUserid() {<br>        <span>return </span><span>userid</span>;<br>    }<br><br>    <span>public void </span>setUserid(String userid) {<br>        <span>this</span>.<span>userid </span>= userid;<br>    }<br><br>    <span>public </span>String getState() {<br>        <span>return </span><span>state</span>;<br>    }<br><br>    <span>public void </span>setState(String state) {<br>        <span>this</span>.<span>state </span>= state;<br>    }<br>}</pre><p>生产者</p><pre><span>package </span>com.wdz.kafka;<br><br><span>import </span>com.alibaba.fastjson.JSON;<br><span>import </span>org.springframework.beans.factory.annotation.<span>Autowired</span>;<br><span>import </span>org.springframework.kafka.core.KafkaTemplate;<br><span>import </span>org.springframework.stereotype.<span>Component</span>;<br><br><span>@Component<br></span><span>public class </span>UserLogProducer {<br><br>    <span>@Autowired<br></span><span>    </span><span>private </span>KafkaTemplate <span>kafkaTemplate</span>;<br><br>    <span>public void </span>sendlog(String userid){<br>        UserLog userlog = <span>new </span>UserLog();<br>        userlog.setUsername(<span>"cxy"</span>);<br>        userlog.setState(<span>"1"</span>);<br>        userlog.setUserid(userid);<br><br>        System.<span>err</span>.println(userlog+<span>"1"</span>);<br><br>        <span>kafkaTemplate</span>.send(<span>"userLog"</span>, JSON.<span>toJSONString</span>(userlog));<br><br>    }<br>}<br></pre><p>消费者</p><pre><span>package </span>com.wdz.kafka;<br><br><span>import </span>org.apache.kafka.clients.consumer.ConsumerRecord;<br><span>import </span>org.springframework.kafka.annotation.<span>KafkaListener</span>;<br><span>import </span>org.springframework.stereotype.<span>Component</span>;<br><br><span>import </span>java.util.Optional;<br><br><span>@Component<br></span><span>public class </span>UserLogConsumer {<br>    <span>@KafkaListener</span>(topics = {<span>"userLog"</span>})<br>    <span>public  void </span>consumer(ConsumerRecord consumerRecord){<br>        Optional kafkaMsg=  Optional.<span>ofNullable</span>(consumerRecord.value());<br>        <span>if </span>(kafkaMsg.isPresent()){<br>            Object msg=  kafkaMsg.get();<br>            System.<span>err</span>.println(msg);<br>        }<br>    }<br>}</pre><p>启动项目运行看一下</p><p><br></p><p><br></p><p>注意：消费者group id即spring.kafka.consumer.group-id的值为你Kafka所配置的值，在你的Kafka文件里面的config里面的consumer.properties文件里面进行修改</p></body>
</html>
