<!DOCTYPE html>
<html>
<head>
<style>body{padding:1.875rem;}</style><meta charset='UTF-8'>
</head>
<body><p>最近在研究spring的源码，在对一个简单的加载xml文件获取bean的测试中发现其中的逻辑比较复杂，特此总结</p><p>测试的环境：idea+maven</p><p>依赖包：spring-beans+spring-core</p><p>bean类：</p><p>public class MyTestBean {</p><p><span>	</span>private String testStr = "testStr";</p><p><br></p><p><span>	</span>public String getTestStr() {</p><p><span>		</span>return testStr;</p><p><span>	</span>}</p><p><br></p><p><span>	</span>public void setTestStr(String testStr) {</p><p><span>		</span>this.testStr = testStr;</p><p><span>	</span>}</p><p><span>	</span></p><p><span>	</span></p><p>}</p><p>bean.xml：</p><p>&lt;?xml version="1.0" encoding="UTF-8"?&gt;</p><p>&lt;beans xmlns="http://www.springframework.org/schema/beans"</p><p>&nbsp; &nbsp; &nbsp; &nbsp;xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"</p><p>&nbsp; &nbsp; &nbsp; &nbsp;xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd"&gt;</p><p>&nbsp; &nbsp; &lt;bean id="myTestBean" class="spring_yuanma_test.MyTestBean"&gt;&lt;/bean&gt;</p><p>&lt;/beans&gt;</p><p>测试类：</p><p>@SuppressWarnings("deprecation")</p><p>public class BeansTest {</p><p><span>	</span></p><p><span>	</span>public static void main(String[] args) {</p><p><span>		</span>BeanFactory bf = new XmlBeanFactory(new ClassPathResource("beans.xml"));</p><p><span>		</span>MyTestBean bean = (MyTestBean)bf.getBean("myTestBean");</p><p><span>		</span>System.out.println(bean.getTestStr());</p><p><span>	</span>}</p><p><span>	</span></p><p><span>	</span></p><p>}</p><p>最终运行结果：testStr</p><p>类介绍：</p><p>BeanFactory:bean工厂，定义获取bean及bean的各种属性</p><p>XmlBeanFactory:对DefaultListableBeanFactory类进行了扩展，主要用于从xml文档中读取BeanDefinition，对于注册及获取bean都是使用从父类DefaultListableBeanFactory继承的方法去实现，而唯独与父类不同的个性化实现就是增加了XmlBeanDefinitionReader类型的reader属性。在XmlBeanFactory中主要使用reader属性对资源文件进行了读取和注册</p><p>ClassPathResource：在resources文件下的文件会被spring的Resource类加载，而ClassPathResource是Resource类的一个实现类</p><p>执行逻辑(代码细节暂时不写，先写个大概的)：</p><p>① 创建ClassPathResource对象实例，额，这一步骤执行了很多代码，我看了一下，执行很多代码也就算了，是很多方法，例如spring会把你的path(你写的beans文件的名字)过滤一遍，就简单的一段<span>StringUtils.</span><span>cleanPath</span><span>(path)执行了太多太多的逻辑了</span></p><p>② 执行XmlBeanFactory构造器创建BeanFactory的对象实例</p><p>③ 执行AbstractBeanFactory的doGetBean方法(在上面就是调用了.getBean方法</p><p>简单的步骤就是这样，总之可以大概括为加载配置文件，读取bean然后通过类加载器注册给需要注入的类</p><p>执行细节：</p><p><br></p><p><br></p></body>
</html>
